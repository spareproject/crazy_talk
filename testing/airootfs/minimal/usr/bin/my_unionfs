#!/bin/env bash
###############################################################################################################################################################################################################
if [[ $# != 2 ]];then echo -e "${0} - help\narg0 - read only underlay\narg1 - read write overlay";exit;fi
###############################################################################################################################################################################################################
if [[ ! -d /mnt/mount/${1}.${2} ]];then mkdir -p /mnt/mount/${1}.${2};fi
if [[ $(mount | grep "/mnt/mount/${1}.${2} ") ]];then echo "something already mounted on /mnt/mount/${1}.${2}";fi
###############################################################################################################################################################################################################
unionfs -o allow_other,use_ino,suid,dev,nonempty -o cow /mnt/mount/${2}=RW:/mnt/mount/${1}=RO /mnt/mount/${1}.${2}
###############################################################################################################################################################################################################
#e im sick of a dirty mount dir... every call that has anything to do with my internal setup is polling mount on call...
for i in $(ls /mnt/mount);do if [[ ! $(mount | grep ${i}) ]];then rmdir /mnt/mount/${i};fi;done
