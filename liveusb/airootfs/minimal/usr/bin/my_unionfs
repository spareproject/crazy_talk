#!/bin/env bash
###############################################################################################################################################################################################################
if [[ $# != 2 ]];then
echo "
${0} - help
arg0 - read only underlay
arg1 - read write overlay
"
exit
fi
###############################################################################################################################################################################################################

if [[ ! $(mount|grep "/mnt/mount/${1} ") ]];then echo "underlay isnt a rawfs...";fi
if [[ -d /mnt/mount/${2} ]];then echo "overlayfs directory already exists...";fi


if [[ $(mount|grep "/mnt/mount/${1}.${2} ") ]];then echo "something already mounted on /mnt/mount/${1}.${2}";fi

if [[ ! -d /mnt/mount/${1}.${2} ]];then mkdir -p /mnt/mount/${1}.${2};fi

###############################################################################################################################################################################################################

unionfs -o allow_other,use_ino,suid,dev,nonempty -o cow /mnt/mount/${2}=RW:/mnt/mount/${1}=RO /mnt/mount/${1}.${2}

###############################################################################################################################################################################################################
for i in $(ls /mnt/mount);do if [[ ! $(mount | grep ${i}) ]];then rmdir /mnt/mount/${i};fi;done
###############################################################################################################################################################################################################
