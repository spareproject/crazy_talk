#!/bin/env bash
###############################################################################################################################################################################################################
clear;cat /etc/banner
echo " [firstboot|oneshot] [setup|unlock|lock] [create] [open|close] [unionfs] [install|wipe] [start|stop|restart] [query] [delete] [list] [poweroff] [rdp]"
echo ""
###############################################################################################################################################################################################################

# rawfs
###############################################################################################################################################################################################################
for i in $(ls /mnt/rawfs/);do 
OUTPUT+="[ ${i} $(du -sh /mnt/rawfs/${i}|awk '{print$1}') ] - "
if [[ -f /mnt/luks/${i} ]];then OUTPUT+="[ key ] ";fi
if [[ -b /dev/mapper/${i} ]];then OUTPUT+="[ mapped ] ";fi
if [[ $(mount | grep "/mnt/mount/${i} ") ]];then OUTPUT+="[ mounted ] ";fi
if [[ $(machinectl | grep "^${i} ") ]];then OUTPUT+="[ boot ] ";fi
OUTPUT+="\n"
done
echo -e $OUTPUT | column -t
###############################################################################################################################################################################################################

# unionfs
###############################################################################################################################################################################################################
echo ""
unset OUTPUT
for i in $(mount | grep unionfs | awk '{print $3}');do
OUTPUT+="[ ${i#/mnt/mount/} ] - [ mounted ] "
if [[ $(machinectl | grep "^${i#/mnt/mount/} ") ]];then OUTPUT+="[ boot ] ";fi
OUTPUT+="\n"
done
echo -e $OUTPUT | column -t
###############################################################################################################################################################################################################

# /mnt/mount/.overlayfs
###############################################################################################################################################################################################################
echo ""
unset OUTPUT
for i in /mnt/mount/.overlayfs/*;do
  OUTPUT+="${i##/mnt/mount/.overlayfs/} "
  OUTPUT+="$(du -sh $i|awk '{print $1}')"
  OUTPUT+="\n"
done
echo -e $OUTPUT | column -t

###############################################################################################################################################################################################################


###############################################################################################################################################################################################################
for i in $(ls /mnt/mount);do if [[ ! $(mount | grep ${i}) ]];then rmdir /mnt/mount/${i};fi;done
###############################################################################################################################################################################################################
