#!/bin/env bash
###############################################################################################################################################################################################################

caps="CAP_DAC_OVERRIDE,CAP_DAC_READ_SEARCH,CAP_FOWNER,CAP_FSETID,CAP_LEASE,CAP_LINUX_IMMUTABLE,CAP_SETFCAP,CAP_SYS_NICE,CAP_SYS_PTRACE,CAP_SYS_TTY_CONFIG,CAP_SYS_RESOURCE,CAP_SYS_BOOT,CAP_AUDIT_WRITE,CAP_AUDIT_CONTROL,"


#CAP_SYS_CHROOT       - no chromium

#CAP_IPC_OWNER        - no ssh
#CAP_KILL             - no ssh
#CAP_NET_BIND_SERVICE - no ssh
#CAP_NET_BROADCAST    - no ssh
#CAP_NET_RAW          - no ssh
#CAP_SETPCAP          - no ssh
#CAP_SYS_ADMIN        - no ssh
#CAP_SETGID           - wont boot
#CAP_SETUID           - wont boot
#CAP_CHOWN            - wont boot

if [[ $(machinectl|grep "rootfs ") ]];then
 while [[ $(machinectl | grep "rootfs ") ]];do
   machinectl poweroff rootfs
  done
fi

(/usr/bin/systemd-nspawn --quiet --boot --network-bridge container --directory /mnt/mount/rootfs --drop-capability=${caps} &>/dev/null &)&
###############################################################################################################################################################################################################
