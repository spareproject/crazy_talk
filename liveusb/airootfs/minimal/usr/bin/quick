#!/bin/env bash
###############################################################################################################################################################################################################
unset input
while [[ ${input} != @("y"|"n") ]];do read -r -p "about to kill everything... continue (y/n)?" input;done
if [[ ${input} == "n" ]];then echo 

echo "totally untested closing you idiot y u no check file before execute"
exit

MACHINECTL=$(machinectl | sed 1d | sed '/^$/d' | sed '$ d' | cut -d " " -f1)
for i in ${MACHINECTL};do
  echo "killing machine - ${i}"
    while [[ $(machinectl | grep "${i} ") ]];do machinectl poweroff ${i};done
done

echo "unmount /mnt/mount..."
while [[ $(mount | grep /mnt/mount) ]];do    
  umount /mnt/mount/*
done

echo "close /dev/mapper"
for i in $(ls /dev/mapper/);do
  if [[ ${i} != "arch_airootfs" && ${i} != "control" ]];then
    cryptsetup close /dev/mapper/${i}
  fi
done


