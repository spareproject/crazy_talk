#!/bin/env bash
###############################################################################################################################################################################################################
if [[ $# != 1 ]];then echo -e "${0} - help\narg0 - rawfs name";exit;fi
###############################################################################################################################################################################################################
if [[ $(machinectl | grep "${1} ") ]];then while [[ $(machinectl | grep "${1} ") ]];do machinectl poweroff ${1};done;fi
if [[ $(mount | grep "/mnt/mount/${1} ") ]];then while [[ $(mount | grep "/mnt/mount/${1} ") ]];do umount /mnt/mount/${1};done;fi
if [[ -b /dev/mapper/${1} ]];then while [[ -b /dev/mapper/${1} ]];do cryptsetup close /dev/mapper/${1};done;fi
# sanity check
if [[ ! $(mount | grep "/mnt/mount/${1} ") && ! -z ${1}  ]];then rmdir /mnt/mount/${1};fi
###############################################################################################################################################################################################################
for i in $(ls /mnt/mount);do if [[ ! $(mount | grep ${i}) ]];then rmdir /mnt/mount/${i};fi;done
###############################################################################################################################################################################################################
