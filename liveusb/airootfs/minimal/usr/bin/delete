#!/bin/env bash
###############################################################################################################################################################################################################
if [[ $# != 1 ]];then echo -e "${0} - help\narg0 - rawfs name";exit;fi
###############################################################################################################################################################################################################
if [[ $(mount | grep unionfs) ]];then echo "deleting with nested deps is fail...";exit;fi
###############################################################################################################################################################################################################
unset finish;while [[ ${finish} != @("y"|"n") ]];do read -r -p "/mnt/rawfs/${1}|/mnt/luks/${1}|/mnt/mount/${1}  continue (y/n)? " finish;done
###############################################################################################################################################################################################################
if [[ ${finish} == n ]];then exit;fi
if [[ ${finish} == y ]];then
#
# cant handle unionfs
# doesnt check if boot
# doesnt check if mounted
# doesnt check if mapped
#
if [[ -f /mnt/rawfs/${1} ]];then echo "deleting /mnt/rawfs/${1}";rm /mnt/rawfs/${1};fi
if [[ -f /mnt/luks/${1} ]];then echo "deleting /mnt/luks/${1}";rm /mnt/luks/${1};fi
if [[ -d /mnt/mount/${1} ]];then echo "deleting /mnt/mount/${1}";rmdir /mnt/mount/${1};fi
fi
###############################################################################################################################################################################################################
for i in $(ls /mnt/mount);do if [[ ! $(mount | grep ${i}) ]];then rmdir /mnt/mount/${i};fi;done
###############################################################################################################################################################################################################
