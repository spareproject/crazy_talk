#!/bin/env bash
###############################################################################################################################################################################################################

unset input;read -rp "start host listener (y|n)?" input
if [[ $input == "y" ]];then

if [[ ! -p /home/user/host.socket ]];then mkfifo /home/user/host.socket;fi
if [[ ! -f /home/user/host.txt ]];then touch /home/user/host.txt;fi

(nc -vulnzp 31279 1>/dev/null 2>/home/user/host.socket &)&

(while :;do
if read line </home/user/host.socket;then
line=$(echo "$line"|awk '{print $4}'|awk -F ':' '{print $1}')
if [[ $(wc -l </home/user/host.txt) -gt 9 ]];then sed -i 1d /home/user/host.txt;fi
echo $line >> /home/user/host.txt
fi
done &)&

#unset input;read -rp "ping network (y|n)?" input
#if [[ $input == "y" ]];then for i in {1..254};do echo fu > /dev/udp/192.168.1.$i/31279;done;fi
#chown user:group /home/user/host.socket
#chown user:group /home/user/host.txt
fi
###############################################################################################################################################################################################################
